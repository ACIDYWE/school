# Сокеты

### Сокеты

На занятии познакомились с сокетами и как они работают. 
Отличная [статья с хабра](https://habrahabr.ru/post/149077/) с похожим примером, который делали мы.

Пример кода, который мог у вас получиться:

<details><summary>server.py</summary>

```python
import socket

sock = socket.socket()

HOST = '' # это означает localhost, что тоже самое - 127.0.0.0
PORT = 31337 # в целом можно использовать любой незанятый порт. А из какого диапазона можно выбрать?


sock.bind((HOST, PORT)) #привязываем адрес и порт

# устанавливаем количество максимальных соединений с сервером и запускаем режим прослушивания
sock.listen(1) 

# теперь мы можем установить соединение
# conn - сокет клиента
# addr - адрес клиента
conn, addr = sock.accept()

print("Connected: ", addr)

# надо помнить, что через сокет мы передаем байты и, чтобы конвертировать строку в байты, мы 
# можем перед строкой поставить префикс b 
conn.send(b"You are connected, send smth\n")
while True:
  # в ответ нам так же приходят байты
  data = conn.recv(1024) 
  # если мы хотим работать как со строкой, то эти байты мы должны конвертировать в символы, 
  # допустим используя кодировку 'utf-8'
  message = data.decode('utf-8')
  print(message)
  if not data or 'quit' in message:
    break

  conn.send(b"Ok, i get it!\n")
conn.close()

# очень важно не забывать закрывать соединение!
sock.close()
```
</details>

<details><summary>client.py</summary>

```python
import socket
import time

sock = socket.socket()
# адрес и порт СЕРВЕРА, куда мы хотим подключиться
HOST = 'localhost'
PORT = 31337

# подключаемся к серверу по ЕГО адресу и порту
sock.connect((HOST, PORT))

# можем также прислать что-нибудь
sock.send(b'Hi\n')

# помните возникала ошибка и клиент с сервером падали?
# так происходило, потому что код же выполняется быстро и сервер не успевал принять данные.
# а таким способом мы просим клиента подождать всего лишь 1 секунду и дальше принимать и отправлять данные.
time.sleep(1)

# также можем получить какие-то данные
data = sock.recv(1024)
print(data)

sock.send(b'quit\n')

# не забываем закрыть соединение!
sock.close()
```
</details>

Еще раз как это концептуально работает:

1. Сначала запускаете сервер. 
2. Он начинает ждать одно (по нашему коду) соединение. 
3. Потом запускаете клиента. 
4. Клиент выполняет какую-то логику и программа завершается.

---

### Домашнее задание
<details><summary>123 + 4653 = ?</summary>
Используя сокеты написать сервис, который загадывает пользователю арифметические примеры. В случае правильного ответа пользователем на 10 примеров, сервис говорит, что пользователь выиграл и завершает свою работу.

Задача: 
- пока что для простоты будем считать, что к нам будет подключаться только один пользователь.
- каждый пример сначала нумеруется, потом уже идет само арифметическое выражение.
- в ответ от пользователя сервис должен ожидать одно число - ответ на пример.
- если пользователь ответил верно, то даем следующий пример, если неверно, то закрываем подключение с ним и ждем нового пользователя.
- для проверки корректности работы серверной части, необходимо написать клиентскую, которая подключается к серверу и решает правильно 10 заданий и получив ответ, что все верно, завершает соединение.

Пример взаимодействия:
```
user$nc localhost 31337
> Hi! You need to solve 10 arithmetic problems:
1. 23 + 45
68
2. 682 + 47
729
3. 669 * 364
2435
> It's wrong!
user$
```
</details>

</details>
